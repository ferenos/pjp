version: '3.8'

services:
  # Client build test
  client-test:
    build:
      context: .
      dockerfile: docker/client/Dockerfile
    container_name: nutandjam-client-test
    volumes:
      - ./build-output/client:/modpack/output
    environment:
      - PACK_VERSION=${PACK_VERSION:-1.0.4}
    networks:
      - modpack-test

  # Server build test
  server-test:
    build:
      context: .
      dockerfile: docker/server/Dockerfile
      args:
        MINECRAFT_VERSION: "1.20.1"
        FORGE_VERSION: "47.4.12"
    container_name: nutandjam-server-test
    volumes:
      - ./build-output/server:/server/logs
    environment:
      - JAVA_OPTS=-Xms2G -Xmx4G
    networks:
      - modpack-test
    # Allocate more resources for server
    mem_limit: 5g
    cpus: 2

networks:
  modpack-test:
    driver: bridge

volumes:
  client-output:
  server-logs:
